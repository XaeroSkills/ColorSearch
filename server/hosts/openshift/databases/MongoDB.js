"use strict";var __awaiter=this&&this.__awaiter||function(n,o,e,t){return new(e||(e=Promise))(function(c,r){function s(n){try{_(t.next(n))}catch(n){r(n)}}function i(n){try{_(t.throw(n))}catch(n){r(n)}}function _(n){n.done?c(n.value):new e(function(o){o(n.value)}).then(s,i)}_((t=t.apply(n,o||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const mongodb_1=require("mongodb");class MongoDB{constructor(){this.conn=null}connection(n){return __awaiter(this,void 0,void 0,function*(){try{yield this.conn.command({connectionStatus:1})}catch(n){try{yield this.reconnect()}catch(n){return console.error("Connection to MongoDB failed."),Promise.reject(new Error("LocalHost MongoDB connection failed."))}}return n?this.conn.collection(n):this.conn})}reconnect(){return __awaiter(this,void 0,void 0,function*(){let n=process.env.OPENSHIFT_MONGODB_DB_URL||process.env.MONGO_URL,o="";if(null==n&&process.env.DATABASE_SERVICE_NAME){const e=process.env.DATABASE_SERVICE_NAME.toUpperCase(),t=process.env[e+"_SERVICE_HOST"],c=process.env[e+"_SERVICE_PORT"],r=process.env[e+"_DATABASE"],s=process.env[e+"_PASSWORD"],i=process.env[e+"_USER"];t&&c&&r&&(o=n="mongodb://",i&&s&&(n+=i+":"+s+"@"),o+=t+":"+c+"/"+r,n+=t+":"+c+"/"+r)}this.conn=yield mongodb_1.MongoClient.connect(n)})}}exports.default=MongoDB;
"use strict";var __awaiter=this&&this.__awaiter||function(e,i,t,n){return new(t||(t=Promise))(function(o,s){function r(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){e.done?o(e.value):new t(function(i){i(e.value)}).then(r,a)}c((n=n.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const mongodb_1=require("mongodb"),Debug=require("debug"),config=require("../app.config.json"),debug=Debug("Settings");class Settings{constructor(e){debug("init settings..."),this.config=e,this.hosting=!0===e.hosting,this.connection=null,this.port=this.hosting?process.env.PORT||process.env.OPENSHIFT_NODEJS_PORT||8080:8080,this.ip=this.hosting?process.env.IP||process.env.OPENSHIFT_NODEJS_IP||"0.0.0.0":"127.0.0.1"}getIp(){return this.ip}getPort(){return this.port}dbConnection(){return __awaiter(this,void 0,void 0,function*(){let e=null;if(null==this.connection&&this.hosting){let i="";if(null==(e=process.env.OPENSHIFT_MONGODB_DB_URL||process.env.MONGO_URL)&&process.env.DATABASE_SERVICE_NAME){const t=process.env.DATABASE_SERVICE_NAME.toUpperCase(),n=process.env[t+"_SERVICE_HOST"],o=process.env[t+"_SERVICE_PORT"],s=process.env[t+"_DATABASE"],r=process.env[t+"_PASSWORD"],a=process.env[t+"_USER"];n&&o&&s&&(i=e="mongodb://",a&&r&&(e+=a+":"+r+"@"),i+=n+":"+o+"/"+s,e+=n+":"+o+"/"+s)}}else mongodb_1.MongoClient&&(e="mongodb://localhost:27017/node");if(null!==e&&mongodb_1.MongoClient)try{this.connection=yield mongodb_1.MongoClient.connect(e)}catch(e){console.error("Unable to connect to MongoDB")}return this.connection})}global(){const e={};return e["server-url"]=this.config["server-url"]||"http://localhost:8080",e["login-required"]=!0===this.config["login-required"],e.user=this.config.user||"admin",e.password=this.config.password||"secret",e["imgs-path"]=this.config["imgs-path"]||"imgs/public",e.ip=this.ip,e.port=this.port,e}textTranslator(){const e=this.config["text-translator"]||{},i={};return i.enabled=!0===e.enabled,i.services=e.services||[],i}imageTagger(){const e=this.config["image-tagger"]||{},i={};return i.enabled=!0===e.enabled,i["similarity-threshold"]=e["similarity-threshold"]||20,i.services=e.services||[],i}imageLoader(){const e=this.config["image-loader"]||{},i={};return i.enabled=!0===e.enabled,i["sleep-time"]="number"==typeof e["sleep-time"]?e["sleep-time"]:864e5,i["time-gap"]="number"==typeof e["time-gap"]?e["time-gap"]:6e4,i["sleep-if-tagging-failed"]=!1!==e["sleep-if-tagging-failed"],i["sleep-if-translation-failed"]=!1!==e["sleep-if-translation-failed"],i}directorySource(){const e=this.config["image-loader"]&&this.config["image-loader"]["directory-source"]?this.config["image-loader"]["directory-source"]:{},i={};return i.enabled=!0===e.enabled,i.step=e.step||5,i.path=e.path||"imgs",i["imgs-path"]=this.global()["imgs-path"],i}flickrSource(){const e=this.config["image-loader"]&&this.config["image-loader"]["flickr-source"]?this.config["image-loader"]["flickr-source"]:{},i={};return i.enabled=!0===e.enabled,i.step=e.step||5,i["word-lists"]=Array.isArray(e["word-lists"])?e["word-lists"]:[],i.randomization="number"==typeof e.randomization?e.randomization:.5,i}imageFinder(){const e=this.config["image-finder"]?this.config["image-finder"]:{},i={};return i["similarity-threshold"]="number"==typeof e["similarity-threshold"]?e["similarity-threshold"]:85,i["default-distance"]=void 0!==e["default-distance"]?e["default-distance"]:"Euclidean",i}index(){const e=this.config.index?this.config.index:{},i={};return i.enabled=!0===e.enabled,i.dimensions="number"==typeof e.dimensions?e.dimensions:512,i.L="number"==typeof e.L?e.L:"auto",i.k="number"==typeof e.k?e.k:4,i.w="number"==typeof e.w?e.w:.4,i.delta="number"==typeof e.delta?e.delta:.1,i.family=void 0!==e.family?e.family:"EuclideanHashFamily",i}}exports.default=new Settings(config);
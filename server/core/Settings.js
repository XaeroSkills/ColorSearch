"use strict";var __awaiter=this&&this.__awaiter||function(e,i,t,s){return new(t||(t=Promise))(function(n,o){function r(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){e.done?n(e.value):new t(function(i){i(e.value)}).then(r,a)}c((s=s.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const Debug=require("debug"),LocalHost_1=require("../hosts/LocalHost"),OpenShift_1=require("../hosts/OpenShift"),hosts=new Map;hosts.set("LocalHost",new LocalHost_1.default),hosts.set("OpenShift",new OpenShift_1.default);const config=require("../app.config.json"),debug=Debug("Settings");class Settings{constructor(e){debug("init settings..."),this.config=e,this.host=e.host&&hosts.has(e.host)?hosts.get(e.host):hosts.get("LocalHost")}dbConnection(){return __awaiter(this,void 0,void 0,function*(){return this.host.dbConnection()})}global(){const e={};return e.serverUrl=this.host.getServerUrl(),e.loginRequired=!0===this.config.loginRequired,e.user=this.config.user||"admin",e.password=this.config.password||"secret",e.imgsPath=this.config.imgsPath||"imgs/public",e.dbCollection=this.config.dbCollection||"images",e.ip=this.host.getIp(),e.port=this.host.getPort(),e}imageDescriptor(){const e=this.config.imageDescriptor||{},i={};return i.colorSpace=e.colorSpace||"rgb",i}textTranslator(){const e=this.config.textTranslator||{},i={};return i.enabled=!0===e.enabled,i.services=e.services||[],i}imageTagger(){const e=this.config.imageTagger||{},i={};return i.enabled=!0===e.enabled,i.similarityThreshold=e.similarityThreshold||20,i.services=e.services||[],i}imageLoader(){const e=this.config.imageLoader||{},i={};return i.enabled=!0===e.enabled,i.sleepTime="number"==typeof e.sleepTime?e.sleepTime:864e5,i.timeGap="number"==typeof e.timeGap?e.timeGap:6e4,i.sleepIfTaggingFailed=!1!==e.sleepIfTaggingFailed,i.sleepIfTranslationFailed=!1!==e.sleepIfTranslationFailed,i}directorySource(){const e=this.config.imageLoader&&this.config.imageLoader.directorySource?this.config.imageLoader.directorySource:{},i={};return i.enabled=!0===e.enabled,i.step=e.step||5,i.path=e.path||"imgs",i.imgsPath=this.global().imgsPath,i}flickrSource(){const e=this.config.imageLoader&&this.config.imageLoader.flickrSource?this.config.imageLoader.flickrSource:{},i={};return i.enabled=!0===e.enabled,i.step=e.step||5,i.wordLists=Array.isArray(e.wordLists)?e.wordLists:[],i.randomization="number"==typeof e.randomization?e.randomization:.5,i}imageFinder(){const e=this.config.imageFinder?this.config.imageFinder:{},i={};return i.similarityThreshold="number"==typeof e.similarityThreshold?e.similarityThreshold:85,i.defaultDistance=void 0!==e.defaultDistance?e.defaultDistance:"Euclidean",i}index(){const e=this.config.index?this.config.index:{},i={};if(i.enabled=!0===e.enabled,i.enabled&&"number"!=typeof e.dimensions)throw new Error("Settings: Index dimensions must be explicitly setted and be an integer.");return i.dimensions="number"==typeof e.dimensions?e.dimensions:0,i.L="number"==typeof e.L?e.L:"auto",i.k="number"==typeof e.k?e.k:4,i.w="number"==typeof e.w?e.w:.4,i.delta="number"==typeof e.delta?e.delta:.1,i.family=void 0!==e.family?e.family:"EuclideanHashFamily",i}}exports.default=new Settings(config);
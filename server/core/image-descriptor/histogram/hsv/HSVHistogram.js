"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const Histogram_1=require("./../Histogram"),Membership_1=require("./../membership/Membership"),TrapezoidalMembership_1=require("./../membership/TrapezoidalMembership"),Debug=require("debug"),debug=Debug("HSVHistogram");class HSVColorMemberships extends Membership_1.AbstractMemberships{constructor(e,s,r){super(),this.memberships=new Array,this.size=e*s*r;const i=360/e,t=i/3,a=new Array,o=new Array,h=new Array,p=new Array,l=new Array,m=100/s,n=m/4,c=m/2;let b=m;const d=100/r,g=d/4,M=d/2;let u=d;for(;b<=100;)a.push(b-c),b+=m;for(;u<=100;)o.push(u-M),u+=d;for(let s=0;s<=e;s++){let r=TrapezoidalMembership_1.default.position.MIDDLE;const a=s*i;switch(s){case 0:r=TrapezoidalMembership_1.default.position.LEFT;break;case e:r=TrapezoidalMembership_1.default.position.RIGHT}h.push(new TrapezoidalMembership_1.default(r,a,t,i))}const z=a.length-1;for(let e=0;e<a.length;e++){let s=TrapezoidalMembership_1.default.position.MIDDLE;const r=a[e];switch(e){case 0:s=TrapezoidalMembership_1.default.position.LEFT;break;case z:s=TrapezoidalMembership_1.default.position.RIGHT}p.push(new TrapezoidalMembership_1.default(s,r,n,m))}const y=o.length-1;for(let e=0;e<o.length;e++){let s=TrapezoidalMembership_1.default.position.MIDDLE;const r=o[e];switch(e){case 0:s=TrapezoidalMembership_1.default.position.LEFT;break;case y:s=TrapezoidalMembership_1.default.position.RIGHT}l.push(new TrapezoidalMembership_1.default(s,r,g,d))}let f=0;const H=h.length-1;for(let e=0;e<h.length;e++)for(const s of p)for(const r of l){const i=new Membership_1.CombinedMembership(h[e],s,r);e!==H?this.memberships.push([i]):(this.memberships[f].push(i),f++)}}getSize(){return this.size}}class HSVGrayscaleMemberships extends Membership_1.AbstractMemberships{constructor(){super(),this.memberships=new Array;const e=[5,20,35,50,65,80,95];this.size=e.length;const s=e.length-1;for(let r=0;r<e.length;r++){let i=TrapezoidalMembership_1.default.position.MIDDLE;const t=e[r];switch(r){case 0:i=TrapezoidalMembership_1.default.position.LEFT;break;case s:i=TrapezoidalMembership_1.default.position.RIGHT}const a=new TrapezoidalMembership_1.default(i,t,10,15),o=new Membership_1.CombinedMembership(a);this.memberships.push([o])}}getSize(){return this.size}}class HSVExtendedFuzzyHistogram extends Histogram_1.AbstractHistogram{constructor(e,s){super(),this.colorMemberships=e,this.grayscaleMemberships=s;const r=TrapezoidalMembership_1.default.position.LEFT;this.grayscaleMembership=new TrapezoidalMembership_1.default(r,2.5,5,20),this.reset(),debug("dimensions: "+(this.colorMemberships.getSize()+this.grayscaleMemberships.getSize()))}addColor(e){if(!this.complete){const s=this.grayscaleMembership.m(Math.min(e.s,e.v)),r=1-s;this.colorMemberships.addValueToHistogram(this.colorHistogramPart,[e.h,e.s,e.v],r),this.grayscaleMemberships.addValueToHistogram(this.greyscaleHistogramPart,[e.v],s)}}reset(){this.colorHistogramPart=new Array(this.colorMemberships.getSize()).fill(0),this.greyscaleHistogramPart=new Array(this.grayscaleMemberships.getSize()).fill(0),this.histogram=new Array(this.colorMemberships.getSize()+this.grayscaleMemberships.getSize()).fill(0),this.complete=!1}done(){this.complete||(this.histogram=this.colorHistogramPart.concat(this.greyscaleHistogramPart),this.colorHistogramPart=new Array,this.greyscaleHistogramPart=new Array,this.normalize(),this.complete=!0)}}class HSVHistogramFactory{constructor(){this.colorMemberships=new Array,this.grayScaleMemberships=new Array,this.colorMemberships.push(new HSVColorMemberships(12,5,5)),this.grayScaleMemberships.push(new HSVGrayscaleMemberships)}getTrapezoidFuzzyHistogram(){return new HSVExtendedFuzzyHistogram(this.colorMemberships[0],this.grayScaleMemberships[0])}}const hsvHistogramFactory=new HSVHistogramFactory;exports.default=hsvHistogramFactory;
"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(s,o){function n(e){try{a(i.next(e))}catch(e){o(e)}}function u(e){try{a(i.throw(e))}catch(e){o(e)}}function a(e){e.done?s(e.value):new r(function(t){t(e.value)}).then(n,u)}a((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const JsonRPC_1=require("./JsonRPC"),md5=require("md5"),Debug=require("debug"),debug=Debug("SlaveNode");class SlaveNode{constructor(e,t,r,i){this.url=e,this.secret=md5(`${t}`),this.id=r,this.timmeout=i}getId(){return this.id}saveDescriptors(e){return __awaiter(this,void 0,void 0,function*(){return debug("saving..."),yield new Promise((t,r)=>{setTimeout(()=>t([]),this.timmeout),JsonRPC_1.default.request(this.url,"saveDescriptors",{descriptors:e},this.secret).then(e=>t(e)).catch(e=>{console.error(e),t([])})})})}deleteDescriptor(e){return __awaiter(this,void 0,void 0,function*(){return yield new Promise((t,r)=>{setTimeout(()=>t(!1),this.timmeout),JsonRPC_1.default.request(this.url,"deleteDescriptor",{id:e},this.secret).then(()=>t()).catch(e=>{console.error(e),t(!1)})})})}findImages(e){return __awaiter(this,void 0,void 0,function*(){return debug("find..."),yield new Promise((t,r)=>{setTimeout(()=>t(new Array),this.timmeout),JsonRPC_1.default.request(this.url,"findImages",{request:e.toJSON()},this.secret).then(e=>{t(e&&e.length>0?Array.from(e):[])}).catch(e=>{console.error(e),t(new Array)})})})}spaceAvailable(){return __awaiter(this,void 0,void 0,function*(){return yield new Promise((e,t)=>{setTimeout(()=>e(!1),this.timmeout),JsonRPC_1.default.request(this.url,"spaceAvailable","",this.secret).then(t=>e(t)).catch(t=>{console.error(t),e(!1)})})})}}exports.default=SlaveNode;
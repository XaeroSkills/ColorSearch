"use strict";var __awaiter=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(r,a){function c(e){try{o(s.next(e))}catch(e){a(e)}}function n(e){try{o(s.throw(e))}catch(e){a(e)}}function o(e){e.done?r(e.value):new i(function(t){t(e.value)}).then(c,n)}o((s=s.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const Distance_1=require("./common/Distance"),TextUtil_1=require("./common/TextUtil"),DescriptorBuilder_1=require("./descriptors/DescriptorBuilder");class SearchRequest{constructor(e,t,i){if(!(e instanceof DescriptorBuilder_1.Descriptor&&t&&i))throw new Error("Invalid constructor arguments");{this.descriptor=e;const s="number"==typeof i.similarityThreshold?i.similarityThreshold:85,r=void 0!==i.defaultDistance?i.defaultDistance:"euclidean";this.searchMode="special"===t.searchMode?"special":"regular",this.similarityLevel="special"===this.searchMode&&void 0!==t.similarityLevel?parseInt(t.similarityLevel.toString(),10):s,this.similarityLevel=this.similarityLevel<50?s:this.similarityLevel,this.distanceName="special"===this.searchMode&&SearchRequest.distances.has(t.distance)?t.distance:r.toLowerCase(),this.distance=SearchRequest.distances.get(this.distanceName),this.maxResult="number"==typeof i.maxResult?i.maxResult:1e4}}static create(e,t,i,s){return __awaiter(this,void 0,void 0,function*(){const r=TextUtil_1.default.uniqSet(t);return DescriptorBuilder_1.DescriptorBuilder.createFromQuery(e,r).then(e=>{if(e instanceof DescriptorBuilder_1.Descriptor)return new SearchRequest(e,i,s);throw new Error("Request build failed")})})}toJSON(){return{similarityLevel:this.similarityLevel,descriptor:this.descriptor.toJSON(),searchMode:this.searchMode,distanceName:this.distanceName,maxResult:this.maxResult}}}SearchRequest.distances=(new Map).set("euclidean",new Distance_1.Euclidean).set("chisquare",new Distance_1.ChiSquare).set("s2jsd",new Distance_1.S2JSD),exports.default=SearchRequest;
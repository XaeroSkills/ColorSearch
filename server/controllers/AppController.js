"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const md5=require("md5"),ImageFinder_1=require("../core/image-finder/ImageFinder"),SearchRequest_1=require("../core/SearchRequest"),Settings_1=require("../core/Settings"),config=Settings_1.default.global();class AppController{constructor(e){this.finder=new ImageFinder_1.default(e);const i=config.user,r=config.password;this.auth=md5(`${i}${r}`),this.loginRequired=config.loginRequired}find(e,i){const r=e.body.id,t=e.body.params.colors,s=e.body.params.words,o=e.body.params.settings,n=e.body.params.auth,d=!this.loginRequired||n===this.auth;t&&s&&o&&d?SearchRequest_1.default.create(t,s,o).then(e=>this.finder.findSimilarImages(e)).then(e=>{console.warn(e.length);const t={jsonrpc:"2.0",result:{imgs:e},id:r};i.writeHead(200,{"content-type":"application/json"}),i.end(JSON.stringify(t))}).catch(r=>{console.error(r),this.error(e,i)}):this.error(e,i)}login(e,i){const r=e.body.params.login;this.succ(e,i,{success:r===this.auth})}isLoginRequired(e,i){this.succ(e,i,{required:this.loginRequired})}error(e,i){const r={jsonrpc:"2.0",result:{},id:e.body.id?e.body.id:0};i.writeHead(200,{"content-type":"application/json"}),i.end(JSON.stringify(r))}succ(e,i,r){const t={jsonrpc:"2.0",result:r,id:e.body.id?e.body.id:0};i.writeHead(200,{"content-type":"application/json"}),i.end(JSON.stringify(t))}}exports.default=AppController;